<Window x:Class="Takt.Fluent.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:prism="http://prismlibrary.com/"
        xmlns:helpers="clr-namespace:Takt.Fluent.Helpers"
        xmlns:fa="clr-namespace:FontAwesome.Sharp;assembly=FontAwesome.Sharp"
        xmlns:local="clr-namespace:Takt.Fluent.Extensions"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="{local:Localization Key=application.title}"
        Height="800"
        Width="1200"
        WindowStartupLocation="CenterScreen"
        MinWidth="780"
        MinHeight="450"
        WindowStyle="None"
        ResizeMode="CanResize"
        Background="{DynamicResource ApplicationBackgroundBrush}">

    <Window.Resources>
        <helpers:EmptyToVisibilityConverter x:Key="EmptyToVisibilityConverter" />
        <helpers:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <helpers:StringToIconCharConverter x:Key="StringToIconCharConverter" />
        <helpers:StringToTranslationConverter x:Key="StringToTranslationConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <helpers:FirstCharConverter x:Key="FirstCharConverter" />
        <helpers:PathToPackUriConverter x:Key="PathToPackUriConverter" />
        <helpers:ValueComparisonConverter x:Key="ValueComparisonConverter" Comparison="LessThanOrEqual" ComparisonValue="80" />
        <helpers:InvertedBooleanToVisibilityConverter x:Key="InvertBooleanToVisibilityConverter" />
        <helpers:TreeViewItemLevelConverter x:Key="TreeViewItemLevelConverter" />
        
        <!-- Fluent Design TreeViewItem 样式 -->
        <Style x:Key="MenuTreeViewItemStyle" TargetType="TreeViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Margin" Value="{Binding RelativeSource={RelativeSource Self}, Converter={StaticResource TreeViewItemLevelConverter}}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TreeViewItem">
                        <StackPanel>
                            <Border x:Name="Bd"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="6"
                                    Padding="0"
                                    Margin="0,1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ContentPresenter x:Name="PART_Header"
                                                      Grid.Column="0"
                                                      ContentSource="Header"
                                                      HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                      VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                    <ToggleButton x:Name="Expander"
                                                  Grid.Column="1"
                                                  ClickMode="Press"
                                                  IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                                  Width="20"
                                                  Height="20"
                                                  Margin="4,0,4,0"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Center"
                                                  Background="Transparent"
                                                  BorderThickness="0">
                                        <ToggleButton.Style>
                                            <Style TargetType="ToggleButton">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ToggleButton">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    BorderThickness="0"
                                                                    CornerRadius="4">
                                                                <Path x:Name="ExpanderPath"
                                                                      Data="M 0 0 L 8 0 L 4 4 Z"
                                                                      Fill="{DynamicResource TextFillColorSecondaryBrush}"
                                                                      HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"
                                                                      RenderTransformOrigin="0.5,0.5">
                                                                    <Path.RenderTransform>
                                                                        <RotateTransform Angle="90"/>
                                                                    </Path.RenderTransform>
                                                                </Path>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter TargetName="ExpanderPath" Property="RenderTransform">
                                                                        <Setter.Value>
                                                                            <RotateTransform Angle="180"/>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </Trigger>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="ExpanderPath" Property="Fill" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasItems, RelativeSource={RelativeSource AncestorType=TreeViewItem}}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ToggleButton.Style>
                                    </ToggleButton>
                                </Grid>
                            </Border>
                            <ItemsPresenter x:Name="ItemsHost"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="False">
                                <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentFillColorTertiaryBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}"/>
                            </MultiTrigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource TextFillColorDisabledBrush}"/>
                                <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Fluent Design 统一按钮样式（基础） -->
        <Style x:Key="FluentTitleBarButtonBaseStyle" TargetType="Button">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect x:Name="shadowEffect"
                                                  Color="Black"
                                                  Opacity="0.08"
                                                  BlurRadius="16"
                                                  ShadowDepth="2"
                                                  Direction="270"/>
                            </Border.Effect>
                            <ContentPresenter x:Name="contentPresenter"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              Content="{TemplateBinding Content}"
                                              ContentTemplate="{TemplateBinding ContentTemplate}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="Black"
                                                          Opacity="0.12"
                                                          BlurRadius="20"
                                                          ShadowDepth="4"
                                                          Direction="270"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource ControlFillColorTertiaryBrush}"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="Black"
                                                          Opacity="0.06"
                                                          BlurRadius="12"
                                                          ShadowDepth="1"
                                                          Direction="270"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Fluent Design 设置按钮样式 -->
        <Style x:Key="FluentSettingsButtonStyle" TargetType="Button" BasedOn="{StaticResource FluentTitleBarButtonBaseStyle}">
            <Setter Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
        </Style>
        
        <!-- Fluent Design 用户信息按钮样式 -->
        <Style x:Key="FluentUserInfoButtonStyle" TargetType="Button" BasedOn="{StaticResource FluentTitleBarButtonBaseStyle}">
            <Setter Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
        </Style>

        <!-- Fluent Design ContextMenu 样式 -->
        <Style x:Key="FluentContextMenuStyle" TargetType="ContextMenu">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <StackPanel Background="Transparent"/>
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ContextMenu">
                        <Border x:Name="Border"
                                Background="{DynamicResource LayerFillColorDefaultBrush}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ItemsPresenter/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Fluent Design MenuItem 基础样式 -->
        <Style x:Key="FluentMenuItemBaseStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="MinHeight" Value="0"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="border"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- 图标容器 -->
                                <ContentPresenter x:Name="IconPresenter"
                                                  Grid.Column="0"
                                                  ContentSource="Icon"
                                                  Margin="0,0,12,0"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Center"/>
                                
                                <!-- 文本容器 -->
                                <ContentPresenter x:Name="HeaderPresenter"
                                                  Grid.Column="1"
                                                  ContentSource="Header"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left"
                                                  RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Fluent Design 用户信息菜单项样式（Info/Primary 色系） -->
        <Style x:Key="FluentMenuItemInfoStyle" TargetType="MenuItem" BasedOn="{StaticResource FluentMenuItemBaseStyle}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="border"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <Grid Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- 图标容器 -->
                                <Border x:Name="IconContainer"
                                        Grid.Column="0"
                                        Margin="0,0,12,0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        Background="Transparent"
                                        BorderBrush="Transparent"
                                        BorderThickness="0"
                                        TextElement.Foreground="{DynamicResource InfoFillColorDefaultBrush}">
                                    <ContentPresenter x:Name="IconPresenter"
                                                      ContentSource="Icon"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Center"/>
                                </Border>
                                
                                <!-- 文本容器 -->
                                <ContentPresenter x:Name="HeaderPresenter"
                                                  Grid.Column="1"
                                                  ContentSource="Header"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left"
                                                  RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource InfoFillColorSecondaryBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource InfoTextFillColorPrimaryBrush}"/>
                                <Setter TargetName="IconContainer" Property="TextElement.Foreground" Value="{DynamicResource InfoTextFillColorPrimaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource InfoFillColorDefaultBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource InfoTextFillColorPrimaryBrush}"/>
                                <Setter TargetName="IconContainer" Property="TextElement.Foreground" Value="{DynamicResource InfoTextFillColorPrimaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Fluent Design 登出菜单项样式（Warning 色系） -->
        <Style x:Key="FluentMenuItemWarningStyle" TargetType="MenuItem" BasedOn="{StaticResource FluentMenuItemBaseStyle}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="border"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <Grid Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- 图标容器 -->
                                <Border x:Name="IconContainer"
                                        Grid.Column="0"
                                        Margin="0,0,12,0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        Background="Transparent"
                                        BorderBrush="Transparent"
                                        BorderThickness="0"
                                        TextElement.Foreground="{DynamicResource WarningFillColorDefaultBrush}">
                                    <ContentPresenter x:Name="IconPresenter"
                                                      ContentSource="Icon"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Center"/>
                                </Border>
                                
                                <!-- 文本容器 -->
                                <ContentPresenter x:Name="HeaderPresenter"
                                                  Grid.Column="1"
                                                  ContentSource="Header"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left"
                                                  RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource WarningFillColorSecondaryBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource WarningTextFillColorPrimaryBrush}"/>
                                <Setter TargetName="IconContainer" Property="TextElement.Foreground" Value="{DynamicResource WarningTextFillColorPrimaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource WarningFillColorDefaultBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource WarningTextFillColorPrimaryBrush}"/>
                                <Setter TargetName="IconContainer" Property="TextElement.Foreground" Value="{DynamicResource WarningTextFillColorPrimaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Fluent Design Separator 样式 -->
        <Style x:Key="FluentMenuSeparatorStyle" TargetType="Separator">
            <Setter Property="Background" Value="{DynamicResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="Height" Value="1"/>
            <Setter Property="Margin" Value="4,0"/>
        </Style>

        <!-- IconBlock 默认样式，确保 IconFont 始终为 Solid，防止空字符串导致错误 -->
        <Style TargetType="fa:IconBlock">
            <Setter Property="IconFont" Value="Solid"/>
            <EventSetter Event="Unloaded" Handler="IconBlock_Unloaded"/>
        </Style>

        <Style x:Key="TitleBarInfoButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseDefaultButtonStyleSmall}">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="0"
                                CornerRadius="0">
                            <ContentPresenter x:Name="contentPresenter"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              Content="{TemplateBinding Content}"
                                              ContentTemplate="{TemplateBinding ContentTemplate}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonInfoHoverBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonInfoHoverBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ButtonTextOnInfoBrush}"/>
                                <Setter TargetName="contentPresenter" Property="TextElement.Foreground" Value="{StaticResource ButtonTextOnInfoBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonInfoPressedBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonInfoPressedBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ButtonTextOnInfoBrush}"/>
                                <Setter TargetName="contentPresenter" Property="TextElement.Foreground" Value="{StaticResource ButtonTextOnInfoBrush}"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsEnabled" Value="False"/>
                                </MultiTrigger.Conditions>
                                <MultiTrigger.Setters>
                                    <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonTextDisabledBrush}"/>
                                    <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonTextDisabledBrush}"/>
                                    <Setter Property="Foreground" Value="{StaticResource ButtonTextDisabledBrush}"/>
                                    <Setter TargetName="contentPresenter" Property="TextElement.Foreground" Value="{StaticResource ButtonTextDisabledBrush}"/>
                                </MultiTrigger.Setters>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="TitleBarCloseButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseDefaultButtonStyleSmall}">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="0"
                                CornerRadius="0">
                            <ContentPresenter x:Name="contentPresenter"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              Content="{TemplateBinding Content}"
                                              ContentTemplate="{TemplateBinding ContentTemplate}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonDangerHoverBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ButtonTextOnDangerBrush}"/>
                                <Setter TargetName="contentPresenter" Property="TextElement.Foreground" Value="{StaticResource ButtonTextOnDangerBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonDangerPressedBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource ButtonTextOnDangerBrush}"/>
                                <Setter TargetName="contentPresenter" Property="TextElement.Foreground" Value="{StaticResource ButtonTextOnDangerBrush}"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsEnabled" Value="False"/>
                                </MultiTrigger.Conditions>
                                <MultiTrigger.Setters>
                                    <Setter TargetName="border" Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{StaticResource ButtonTextDisabledBrush}"/>
                                    <Setter TargetName="contentPresenter" Property="TextElement.Foreground" Value="{StaticResource ButtonTextDisabledBrush}"/>
                                </MultiTrigger.Setters>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>
    
    <Border x:Name="HighContrastBorder" 
            BorderBrush="Transparent" 
            BorderThickness="8 1 8 8">
        <Grid x:Name="MainGrid">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header: 标题栏 -->
            <Grid
                Grid.Row="0"
                Height="44"
                MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" /> <!-- Logo -->
                    <ColumnDefinition Width="*" /> <!-- 标题（可选） -->
                    <ColumnDefinition Width="Auto" /> <!-- 设置按钮 -->
                    <ColumnDefinition Width="Auto" /> <!-- 用户信息下拉 -->
                    <ColumnDefinition Width="Auto" /> <!-- 最小化 -->
                    <ColumnDefinition Width="Auto" /> <!-- 最大化 -->
                    <ColumnDefinition Width="Auto" /> <!-- 关闭 -->
                </Grid.ColumnDefinitions>

                <!-- VS2022 样式的 Logo 容器 -->
                <Border
                    Grid.Column="0"
                    Width="48"
                    Height="32"
                    Margin="8,0,0,0"
                    Background="Transparent"
                    BorderThickness="0"
                    VerticalAlignment="Center">
                    <Border
                        x:Name="LogoContainer"
                        Width="32"
                        Height="32"
                        CornerRadius="6"
                        BorderThickness="1"
                        Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Left">
                        <Image
                            Width="24"
                            Height="24"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Source="pack://application:,,,/Assets/takt.ico"
                            Stretch="Uniform"
                            RenderOptions.BitmapScalingMode="HighQuality"/>
                    </Border>
                </Border>

                <!-- 标题（可选，可隐藏） -->
                <StackPanel
                    Grid.Column="1"
                    Margin="8,0,8,0"
                    Orientation="Horizontal"
                    VerticalAlignment="Center">
                    <TextBlock
                        VerticalAlignment="Center"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        Text="{local:Localization Key=application.title}" />
                </StackPanel>

                <!-- 设置按钮 -->
                <Button
                    x:Name="SettingsButton"
                    Grid.Column="2"
                    Margin="8,0,8,0"
                    Style="{StaticResource FluentSettingsButtonStyle}"
                    VerticalAlignment="Center"
                    Command="{Binding ViewModel.SettingsCommand}"
                    ToolTip="{local:Localization Key=menu.settings}">
                    <fa:IconBlock Icon="Gear"
                                  IconFont="Solid"
                                  Width="18"
                                  Height="18"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Button>

                <!-- 用户信息下拉按钮 -->
                <Button
                    x:Name="UserInfoButton"
                    Grid.Column="3"
                    Margin="8,0,8,0"
                    Style="{StaticResource FluentUserInfoButtonStyle}"
                    VerticalAlignment="Center"
                    Click="UserInfoButton_Click"
                    ToolTip="{Binding ViewModel.CurrentUsername}">
                    <Button.ContextMenu>
                        <ContextMenu Style="{StaticResource FluentContextMenuStyle}">
                            <MenuItem 
                                Header="{local:Localization Key=mainwindow.userinfocenter}" 
                                Click="UserInfoMenuItem_Click"
                                Style="{StaticResource FluentMenuItemInfoStyle}">
                                <MenuItem.Icon>
                                    <fa:IconBlock
                                        Icon="User"
                                        IconFont="Solid"
                                        Width="16"
                                        Height="16"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <Separator Style="{StaticResource FluentMenuSeparatorStyle}"/>
                            <MenuItem 
                                Header="{local:Localization Key=common.button.exit}" 
                                Click="LogoutMenuItem_Click"
                                Style="{StaticResource FluentMenuItemWarningStyle}">
                                <MenuItem.Icon>
                                    <fa:IconBlock
                                        Icon="RightFromBracket"
                                        IconFont="Solid"
                                        Width="16"
                                        Height="16"/>
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </Button.ContextMenu>
                    <fa:IconBlock Icon="User"
                                  IconFont="Solid"
                                  Width="18"
                                  Height="18"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Button>

                <Button
                    x:Name="MinimizeButton"
                    Grid.Column="4"
                    Style="{StaticResource TitleBarInfoButtonStyle}"
                    Width="32"
                    Height="32"
                    MinHeight="0"
                    Padding="0"
                    Click="MinimizeWindow">
                    <fa:IconBlock Icon="Minus"
                                  IconFont="Solid"
                                  Width="14"
                                  Height="14"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Button>

                <Button
                    x:Name="MaximizeButton"
                    Grid.Column="5"
                    Style="{StaticResource TitleBarInfoButtonStyle}"
                    Width="32"
                    Height="32"
                    MinHeight="0"
                    Padding="0"
                    Click="MaximizeWindow">
                    <fa:IconBlock x:Name="MaximizeIcon"
                                  Icon="Square"
                                  IconFont="Regular"
                                  Width="14"
                                  Height="14"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Button>

                <Button
                    x:Name="CloseButton"
                    Grid.Column="6"
                    Style="{StaticResource TitleBarCloseButtonStyle}"
                    Width="32"
                    Height="32"
                    MinHeight="0"
                    Padding="0"
                    Click="CloseWindow">
                    <fa:IconBlock Icon="Xmark"
                                  IconFont="Solid"
                                  Width="16"
                                  Height="16"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Button>
            </Grid>

            <!-- Content: 主要内容区域 -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition x:Name="SidebarColumn" Width="240" MinWidth="64" MaxWidth="320" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                    <Grid Grid.Column="0" x:Name="SidebarGrid" MinWidth="64" MaxWidth="320">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TreeView
                        x:Name="MenusList"
                        Grid.Row="0"
                        Margin="0,8,0,8"
                        AutomationProperties.Name="导航菜单"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        ItemsSource="{Binding ViewModel.Menus}"
                        SelectedItemChanged="MenusList_SelectedItemChanged"
                        PreviewKeyDown="MenusList_PreviewKeyDown"
                        PreviewMouseLeftButtonUp="MenusList_PreviewMouseLeftButtonUp"
                        Loaded="MenusList_Loaded"
                        ItemContainerStyle="{StaticResource MenuTreeViewItemStyle}">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <Grid MinHeight="30" Margin="8,0,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="2" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <fa:IconBlock x:Name="MenuIcon"
                                        Width="16"
                                        Height="16"
                                        VerticalAlignment="Center"
                                        IconFont="Solid"
                                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                        Icon="{Binding Icon, Converter={StaticResource StringToIconCharConverter}}"
                                        Visibility="{Binding Icon, Converter={StaticResource EmptyToVisibilityConverter}}">
                                        <fa:IconBlock.ToolTip>
                                            <ToolTip Tag="{Binding ElementName=SidebarGrid, Path=ActualWidth}">
                                                <ToolTip.Style>
                                                    <Style TargetType="ToolTip">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <DataTrigger>
                                                                <DataTrigger.Binding>
                                                                    <Binding Path="Tag" RelativeSource="{RelativeSource Self}" Converter="{StaticResource ValueComparisonConverter}"/>
                                                                </DataTrigger.Binding>
                                                                <DataTrigger.Value>
                                                                    <sys:Boolean>True</sys:Boolean>
                                                                </DataTrigger.Value>
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ToolTip.Style>
                                                <TextBlock DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType={x:Type ToolTip}}}">
                                                    <TextBlock.Text>
                                                        <MultiBinding Converter="{StaticResource StringToTranslationConverter}">
                                                            <Binding Path="I18nKey" />
                                                            <Binding Path="MenuName" />
                                                            <Binding Source="{x:Static helpers:LocalizationAdapterHelper.Adapter}" Path="CurrentLanguageCode" Mode="OneWay" FallbackValue="" TargetNullValue="" />
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </ToolTip>
                                        </fa:IconBlock.ToolTip>
                                    </fa:IconBlock>
                                    <TextBlock x:Name="MenuText"
                                        Grid.Column="2"
                                        VerticalAlignment="Center"
                                        Foreground="{DynamicResource TextFillColorPrimaryBrush}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger>
                                                        <DataTrigger.Binding>
                                                            <Binding Path="ActualWidth" ElementName="SidebarGrid" Converter="{StaticResource ValueComparisonConverter}"/>
                                                        </DataTrigger.Binding>
                                                        <DataTrigger.Value>
                                                            <sys:Boolean>True</sys:Boolean>
                                                        </DataTrigger.Value>
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{StaticResource StringToTranslationConverter}">
                                                <Binding Path="I18nKey" />
                                                <Binding Path="MenuName" />
                                                <Binding Source="{x:Static helpers:LocalizationAdapterHelper.Adapter}" Path="CurrentLanguageCode" Mode="OneWay" FallbackValue="" TargetNullValue="" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </Grid>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </Grid>
                
                <!-- GridSplitter 用于调整侧边栏宽度（放在列1，位于侧边栏和内容区域之间） -->
                <GridSplitter Grid.Column="1"
                              Grid.Row="1"
                              Width="4"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              Background="Transparent"
                              Cursor="SizeWE"
                              ResizeDirection="Columns"
                              ShowsPreview="False"
                              DragDelta="SidebarSplitter_DragDelta"
                              DragCompleted="SidebarSplitter_DragCompleted"/>
                
                <Border
                    Grid.Column="2"
                    Margin="0"
                    Padding="0"
                    BorderThickness="1"
                    CornerRadius="8,0,0,0"
                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch">
                    <!-- TabControl 内容区域容器，确保无顶部间距 -->
                    <!-- Fluent Design TabControl - 原生 TabControl，100% 遵守 Fluent Design 风格 -->
                    <!-- 使用 DocumentTabs 绑定，NavigationService 负责更新集合 -->
                    <TabControl x:Name="DocumentTabControl"
                                ItemsSource="{Binding ViewModel.DocumentTabs}"
                                SelectedItem="{Binding ViewModel.SelectedTab, Mode=TwoWay}"
                                Background="{DynamicResource LayerFillColorDefaultBrush}"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch">
                        <TabControl.Template>
                            <ControlTemplate TargetType="TabControl">
                                <Grid KeyboardNavigation.TabNavigation="Local">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Border Grid.Row="0"
                                            Background="{DynamicResource LayerFillColorDefaultBrush}"
                                            Margin="0"
                                            BorderThickness="0,0,1,1"
                                            BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}">
                                        <TabPanel x:Name="HeaderPanel"
                                                  Panel.IsItemsHost="True"
                                                  KeyboardNavigation.TabIndex="1"
                                                  Margin="8,8,0,0"/>
                                    </Border>
                                    <ContentPresenter x:Name="PART_SelectedContentHost"
                                                     Grid.Row="1"
                                                     Margin="0"
                                                     ContentSource="SelectedContent"
                                                     HorizontalAlignment="Stretch"
                                                     VerticalAlignment="Stretch"/>
                                </Grid>
                            </ControlTemplate>
                        </TabControl.Template>
                        <TabControl.ItemContainerStyle>
                            <Style TargetType="TabItem">
                                <Setter Property="Content" Value="{Binding Content}"/>
                                <Setter Property="Background" Value="{DynamicResource LayerFillColorDefaultBrush}"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}"/>
                                <Setter Property="BorderThickness" Value="1,1,1,1"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0,0,0,0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TabItem">
                                            <Border x:Name="Bd"
                                                    Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="6,6,0,0"
                                                    Padding="12,8,12,8">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <fa:IconBlock Grid.Column="0"
                                                                 Icon="{Binding Icon, Converter={StaticResource StringToIconCharConverter}}"
                                                                 Width="16"
                                                                 Height="16"
                                                                 Margin="0,0,8,0"
                                                                 Foreground="{TemplateBinding Foreground}"
                                                                 Visibility="{Binding Icon, Converter={StaticResource EmptyToVisibilityConverter}}"/>

                                                    <TextBlock x:Name="TitleText"
                                                             Grid.Column="1"
                                                             Text="{Binding Title}"
                                                             VerticalAlignment="Center"
                                                             Foreground="{TemplateBinding Foreground}"
                                                             TextTrimming="CharacterEllipsis"/>

                                                    <TextBlock Grid.Column="2"
                                                             Text="*"
                                                             Margin="6,0,0,0"
                                                             Foreground="{DynamicResource AccentFillColorDefaultBrush}"
                                                             Visibility="{Binding IsModified, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                                                    <Button Grid.Column="3"
                                                            x:Name="CloseButton"
                                                            Style="{StaticResource DefaultDangerNoSmall}"
                                                            Width="20"
                                                            Height="20"
                                                            MinHeight="0"
                                                            Padding="0"
                                                            Margin="8,0,0,0"
                                                            ToolTip="{local:Localization Key=common.button.close}"
                                                            Visibility="{Binding CanClose, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                            Click="TabItem_CloseButtonClick">
                                                        <fa:IconBlock Icon="{x:Static fa:IconChar.Xmark}"
                                                                      FontSize="12"
                                                                      Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
                                                    </Button>
                                                </Grid>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Bd" Property="BorderThickness" Value="1,1,1,1"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource LayerFillColorSecondaryBrush}"/>
                                        <Setter Property="BorderBrush" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                                        <Setter Property="BorderThickness" Value="1,1,1,1"/>
                                        <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
                                        <Setter Property="Panel.ZIndex" Value="10"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Foreground" Value="{DynamicResource TextFillColorDisabledBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TabControl.ItemContainerStyle>
                        <TabControl.Resources>
                            <Style TargetType="TabPanel">
                                <Setter Property="Margin" Value="8,0,8,0"/>
                                <Setter Property="Background" Value="{DynamicResource LayerFillColorDefaultBrush}"/>
                            </Style>
                        </TabControl.Resources>
                    </TabControl>
                </Border>
            </Grid>

            <!-- Footer: 状态栏 -->
            <Border
                Grid.Row="2"
                Height="24"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- 左侧：版权信息 -->
                    <StackPanel
                        Grid.Column="0"
                        Orientation="Horizontal"
                        Margin="8,0,0,0"
                        VerticalAlignment="Center"
                        Opacity="0.8">
                        <TextBlock
                            FontSize="12"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="©"/>
                        <TextBlock
                            FontSize="12"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="{Binding Source={x:Static sys:DateTime.Now}, Path=Year}"
                            Margin="4,0,0,0"/>
                        <TextBlock
                            FontSize="12"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="{local:Localization Key=common.app.copyright}"
                            Margin="4,0,0,0"/>                            
                    </StackPanel>
                    
                    <!-- 中间：消息通知区域 -->
                    <Border
                        x:Name="StatusBarMessageArea"
                        Grid.Column="1"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Padding="8,0"
                        Visibility="{Binding ViewModel.StatusBarMessage, Converter={StaticResource NullToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <materialDesign:PackIcon
                                Kind="{Binding ViewModel.StatusBarMessageIcon}"
                                Width="16"
                                Height="16"
                                VerticalAlignment="Center"
                                Margin="0,0,8,0"
                                Foreground="{Binding ViewModel.StatusBarMessageBrush}"/>
                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="12"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                Text="{Binding ViewModel.StatusBarMessage}"
                                TextWrapping="NoWrap"
                                TextTrimming="CharacterEllipsis"
                                MaxWidth="400"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 右侧：活动文档标题 -->
                    <StackPanel
                        Grid.Column="2"
                        Orientation="Horizontal"
                        Margin="0,0,8,0">
                        <TextBlock
                            VerticalAlignment="Center"
                            FontSize="12"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="{Binding ViewModel.ActiveDocumentTitle}"
                            Margin="0,0,16,0" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
