<Window x:Class="Takt.Fluent.Views.Generator.CodeGenComponent.ImportTableView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Takt.Fluent.Extensions"
        xmlns:controls="clr-namespace:Takt.Fluent.Controls"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        d:DesignHeight="600"
        d:DesignWidth="800"
        Title="{local:Localization Key=generator.importtable.title}"
        SizeToContent="Manual"
        WindowStartupLocation="Manual"
        ResizeMode="CanResize"
        Background="{DynamicResource MaterialDesignPaper}">
    <Window.Resources>
        <!-- 数据表格行样式 -->
        <Style x:Key="ImportDataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="{DynamicResource MaterialDesignPaper}"/>
            <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource MaterialDesignDivider}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource MaterialDesignCardBackground}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                    <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}"/>
                </Trigger>
                <MultiTrigger>
                    <MultiTrigger.Conditions>
                        <Condition Property="IsSelected" Value="True"/>
                        <Condition Property="Selector.IsSelectionActive" Value="False"/>
                    </MultiTrigger.Conditions>
                    <Setter Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                    <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}"/>
                </MultiTrigger>
                <MultiTrigger>
                    <MultiTrigger.Conditions>
                        <Condition Property="IsSelected" Value="True"/>
                        <Condition Property="IsMouseOver" Value="True"/>
                    </MultiTrigger.Conditions>
                    <Setter Property="Background" Value="{DynamicResource AccentFillColorTertiaryBrush}"/>
                    <Setter Property="Foreground" Value="{DynamicResource TextOnAccentFillColorPrimaryBrush}"/>
                </MultiTrigger>
            </Style.Triggers>
        </Style>

        <!-- 数据表格单元格样式 -->
        <Style x:Key="ImportDataGridCellStyle" TargetType="DataGridCell">
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="TextBlock.TextTrimming" Value="CharacterEllipsis"/>
            <Setter Property="TextBlock.VerticalAlignment" Value="Center"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}"
                                SnapsToDevicePixels="True">
                            <ContentPresenter VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            HorizontalAlignment="Left"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 数据表格列头样式 -->
        <Style x:Key="ImportDataGridColumnHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{DynamicResource MaterialDesignCardBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource MaterialDesignDivider}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}"
                                SnapsToDevicePixels="True"
                                VerticalAlignment="Stretch"
                                HorizontalAlignment="Stretch">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 数据库信息 -->
        <TextBlock Grid.Row="0" 
                   Text="{Binding DatabaseName, StringFormat='数据库: {0}'}"
                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                   Margin="0,0,0,16"/>

        <!-- 搜索栏 -->
        <Grid Grid.Row="1" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     materialDesign:HintAssist.Hint="{local:Localization Key=common.placeholder.keywordHint, Param0Key=generator.importtable.tablename}"
                     materialDesign:TextFieldAssist.DecorationVisibility="Collapsed"
                     MinHeight="32"
                     Padding="12,6"
                     FontSize="13"
                     VerticalAlignment="Center"
                     VerticalContentAlignment="Center"
                     Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                     materialDesign:HintAssist.Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                     Text="{Binding Keyword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <Button Grid.Column="1"
                    Command="{Binding ResetCommand}"
                    Content="{local:Localization Key=common.reset}"
                    Style="{StaticResource DefaultInfo}"
                    Margin="12,0,0,0"/>
        </Grid>

        <!-- 表列表和列信息 -->
        <Grid Grid.Row="2" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- 表列表 -->
            <DataGrid Grid.Column="0"
                      x:Name="TablesDataGrid"
                      ItemsSource="{Binding Tables}"
                      SelectedItem="{Binding SelectedTable, Mode=TwoWay}"
                      SelectionMode="Extended"
                      SelectionUnit="FullRow"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      GridLinesVisibility="All"
                      HeadersVisibility="All"
                      RowStyle="{StaticResource ImportDataGridRowStyle}"
                      CellStyle="{StaticResource ImportDataGridCellStyle}"
                      ColumnHeaderStyle="{StaticResource ImportDataGridColumnHeaderStyle}"
                      LoadingRow="TablesDataGrid_LoadingRow"
                      SelectionChanged="TablesDataGrid_SelectionChanged">
                <DataGrid.Style>
                    <Style TargetType="DataGrid" BasedOn="{StaticResource MaterialDesignDataGrid}">
                        <Setter Property="RowHeight" Value="36"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="AlternatingRowBackground" Value="{x:Null}"/>
                    </Style>
                </DataGrid.Style>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="{local:Localization Key=generator.importtable.tablename}"
                                        Binding="{Binding TableName}"
                                        Width="Auto"/>
                    <DataGridTextColumn Header="{local:Localization Key=generator.importtable.description}"
                                        Binding="{Binding Description}"
                                        Width="Auto"/>
                </DataGrid.Columns>
            </DataGrid>

            <GridSplitter Grid.Column="1" 
                          HorizontalAlignment="Stretch" 
                          VerticalAlignment="Stretch"
                          Background="{DynamicResource MaterialDesignDivider}"/>

            <!-- 列信息 -->
            <DataGrid Grid.Column="2"
                      x:Name="ColumnsDataGrid"
                      ItemsSource="{Binding Columns}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      GridLinesVisibility="All"
                      HeadersVisibility="All"
                      RowStyle="{StaticResource ImportDataGridRowStyle}"
                      CellStyle="{StaticResource ImportDataGridCellStyle}"
                      ColumnHeaderStyle="{StaticResource ImportDataGridColumnHeaderStyle}"
                      LoadingRow="ColumnsDataGrid_LoadingRow">
                <DataGrid.Style>
                    <Style TargetType="DataGrid" BasedOn="{StaticResource MaterialDesignDataGrid}">
                        <Setter Property="RowHeight" Value="36"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="AlternatingRowBackground" Value="{x:Null}"/>
                    </Style>
                </DataGrid.Style>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="{local:Localization Key=generator.importtable.columnname}"
                                        Binding="{Binding ColumnName}"
                                        Width="Auto"/>
                    <DataGridTextColumn Header="{local:Localization Key=generator.importtable.columndescription}"
                                        Binding="{Binding Description}"
                                        Width="Auto"/>
                    <DataGridTextColumn Header="{local:Localization Key=generator.importtable.datatype}"
                                        Binding="{Binding DataType}"
                                        Width="Auto"/>
                    <DataGridTextColumn Header="{local:Localization Key=generator.importtable.length}"
                                        Binding="{Binding Length, TargetNullValue='-'}"
                                        Width="Auto"/>
                    <DataGridTextColumn Header="{local:Localization Key=generator.importtable.decimalplaces}"
                                        Binding="{Binding DecimalPlaces, TargetNullValue='-'}"
                                        Width="Auto"/>
                    <DataGridTextColumn Header="{local:Localization Key=generator.importtable.defaultvalue}"
                                        Binding="{Binding DefaultValue, TargetNullValue='-'}"
                                        Width="Auto"/>
                    <DataGridCheckBoxColumn Header="{local:Localization Key=generator.importtable.isprimarykey}"
                                            Binding="{Binding IsPrimaryKey}"
                                            Width="Auto"/>
                    <DataGridCheckBoxColumn Header="{local:Localization Key=generator.importtable.isidentity}"
                                            Binding="{Binding IsIdentity}"
                                            Width="Auto"/>
                    <DataGridCheckBoxColumn Header="{local:Localization Key=generator.importtable.isnullable}"
                                            Binding="{Binding IsNullable}"
                                            Width="Auto"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- 按钮栏 -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button IsDefault="True"
                    Command="{Binding ImportFromTableCommand}"
                    Content="{local:Localization Key=common.button.import}"
                    Style="{StaticResource DefaultPrimary}"
                    Margin="0,0,12,0"/>
            <Button IsCancel="True"
                    Content="{local:Localization Key=common.button.cancel}"
                    Style="{StaticResource DefaultInfo}"/>
        </StackPanel>
    </Grid>
</Window>

