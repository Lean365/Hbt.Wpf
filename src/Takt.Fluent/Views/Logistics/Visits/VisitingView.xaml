<UserControl x:Class="Takt.Fluent.Views.Logistics.Visits.VisitingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="clr-namespace:Takt.Fluent.Controls"
             xmlns:local="clr-namespace:Takt.Fluent.Extensions"
             mc:Ignorable="d"
             d:DesignHeight="720"
             d:DesignWidth="1280">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="300" MinHeight="200" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" MinHeight="200" />
        </Grid.RowDefinitions>

        <!-- 主表：来访公司 -->
        <controls:TaktDataGrid Grid.Row="0"
                                x:Name="VisitingCompanyDataGrid"
                                ItemsSource="{Binding VisitingCompanies}"
                                SelectedItem="{Binding SelectedVisitingCompany, Mode=TwoWay}"
                                QueryKeyword="{Binding VisitingCompanyKeyword, Mode=TwoWay}"
                                QueryPlaceholder="{local:Localization Key=common.placeholder.keywordHint, Param0Key=logistics.visits.visitingcompany.query.keyword}"
                                ShowToolbarCreate="True"
                                ShowToolbarUpdate="True"
                                ShowToolbarDelete="True"
                                ShowToolbarImport="True"
                                ShowToolbarExport="True"
                                CreateCommand="{Binding CreateVisitingCompanyCommand}"
                                UpdateCommand="{Binding UpdateVisitingCompanyCommand}"
                                DeleteCommand="{Binding DeleteVisitingCompanyCommand}"
                                ImportCommand="{Binding ImportCommand}"
                                ExportCommand="{Binding ExportCommand}"
                                DownloadTemplateCommand="{Binding DownloadTemplateCommand}"
                                RowUpdateCommand="{Binding UpdateVisitingCompanyCommand}"
                                RowDeleteCommand="{Binding DeleteVisitingCompanyCommand}"
                                PageIndex="{Binding VisitorPageIndex, Mode=TwoWay}"
                                PageSize="{Binding VisitorPageSize, Mode=TwoWay}"
                                TotalCount="{Binding VisitorTotalCount}"
                                QueryCommand="{Binding QueryVisitingCompanyCommand}"
                                ResetCommand="{Binding ResetVisitingCompanyCommand}"
                                PageChangedCommand="{Binding PageChangedVisitingCompanyCommand}"
                                Loaded="VisitingCompanyDataGrid_Loaded">
            <controls:TaktDataGrid.Columns>
                <controls:TaktDataGridColumnDefinition Header="{local:Localization Key=logistics.visits.visitingcompany.visitingcompanyname}" BindingPath="VisitingCompanyName" Width="*" />
                <controls:TaktDataGridColumnDefinition Header="{local:Localization Key=logistics.visits.visitingcompany.visitstarttime}" BindingPath="VisitStartTime" Width="150" />
                <controls:TaktDataGridColumnDefinition Header="{local:Localization Key=logistics.visits.visitingcompany.visitendtime}" BindingPath="VisitEndTime" Width="150" />
            </controls:TaktDataGrid.Columns>
        </controls:TaktDataGrid>

        <GridSplitter Grid.Row="1" Height="6" VerticalAlignment="Center" HorizontalAlignment="Stretch" />

        <!-- 子表：来访成员详情（支持行内编辑） -->
        <controls:TaktInlineEditDataGrid Grid.Row="2"
                                         x:Name="VisitingEntourageDataGrid"
                                         ItemsSource="{Binding VisitingEntourages}"
                                         SelectedItem="{Binding SelectedVisitingEntourage, Mode=TwoWay}"
                                         EditingItem="{Binding EditingVisitingEntourage, Mode=TwoWay}"
                                         ShowQueryArea="True"
                                         QueryKeyword="{Binding VisitingEntourageKeyword, Mode=TwoWay}"
                                         QueryPlaceholder="{local:Localization Key=common.placeholder.keywordHint, Param0Key=logistics.visits.visitingentourage.query.keyword}"
                                         QueryCommand="{Binding QueryVisitingEntourageCommand}"
                                         ResetCommand="{Binding ResetVisitingEntourageCommand}"
                                         ShowToolbar="True"
                                         ShowToolbarAddRow="True"
                                         AddRowCommand="{Binding CreateVisitingEntourageInlineCommand}"
                                         RowUpdateCommand="{Binding UpdateVisitingEntourageInlineCommand}"
                                         RowSaveCommand="{Binding SaveVisitingEntourageInlineCommand}"
                                         RowCancelCommand="{Binding CancelVisitingEntourageInlineCommand}"
                                         RowDeleteCommand="{Binding DeleteVisitingEntourageCommand}"
                                         ShowRowUpdate="True"
                                         ShowRowSave="True"
                                         ShowRowCancel="True"
                                         ShowRowDelete="True"
                                         EmptyText="{local:Localization Key=common.noData}"
                                         Loaded="VisitingEntourageDataGrid_Loaded">
            <controls:TaktInlineEditDataGrid.Columns>
                <controls:TaktDataGridColumnDefinition Header="{local:Localization Key=logistics.visits.visitingentourage.visitingcompanyid}" BindingPath="VisitingCompanyId" Width="100" />
                <controls:TaktDataGridColumnDefinition Header="{local:Localization Key=logistics.visits.visitingentourage.visitdept}" BindingPath="VisitDept" Width="150" />
                <controls:TaktDataGridColumnDefinition Header="{local:Localization Key=logistics.visits.visitingentourage.visitingmembers}" BindingPath="VisitingMembers" Width="150" />
                <controls:TaktDataGridColumnDefinition Header="{local:Localization Key=logistics.visits.visitingentourage.visitpost}" BindingPath="VisitPost" Width="150" />
            </controls:TaktInlineEditDataGrid.Columns>
        </controls:TaktInlineEditDataGrid>
    </Grid>
</UserControl>

